"""
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 406, in onclick
    self.flash()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 458, in flash
    self.canv.itemconfig(self.bord, fill="black")
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2578, in itemconfigure
    return self._configure(('itemconfigure', tagOrId), cnf, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1476, in _configure
    self.tk.call(_flatten((self._w, cmd)) + self._options(cnf))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
>>> %Run MS71_Minglang_CF.py
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Not enough money!
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
Exception in Tkinter callback
Traceback (most recent call last):
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 1705, in __call__
    return self.func(*args)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 117, in onclick
    b.onclick()
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 408, in onclick
    self.canv.gwind.start(self.text, override=True)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 160, in start
    self.init(level)
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 168, in init
    self.t = Transition(self, func = "create")
  File "H:\Other\ComputerFair\MS71_Minglang_CF.py", line 358, in __init__
    super().__init__(500, 0, 500, 500, canv)
  File "H:\Other\ComputerFair\objects.py", line 17, in __init__
    self.draw()
  File "H:\Other\ComputerFair\objects.py", line 21, in draw
    self.parts.append(self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill="black"))
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2501, in create_rectangle
    return self._create('rectangle', args, kw)
  File "C:\Program Files (x86)\Thonny\lib\tkinter\__init__.py", line 2480, in _create
    *(args + self._options(cnf, kw))))
_tkinter.TclError: invalid command name ".!toplevel.!ghandler"
>>> 

"""
import tkinter as tk
from tkinter import messagebox
from tkinter.font import Font
import pickle
import os
import random

from objects import * # user created module

buttons = []

# handles the main menu and its canvas
class cHandler(tk.Canvas):
    def __init__(self, window, length, width, gwind=None):
        super().__init__(window, width=length, height = width)
        # store various values
        self.root = window
        self.tick = 0
        self.length = length
        self.width = width
        self.objs = []
        self.buttons = []
        self.started = False
        self.stopped = [] # unused objects destroyed by garbage collection algorithm
        self.gwind = gwind
        # detect motion and button clicks
        self.bind_all("<Motion>", self.store)
        self.bind_all("<Button-1>", self.onclick)
        # begin mainloop
        self.mainloop()
    
    def add(self, row = 1, column = 1):
        # add canvas to main menu
        self.grid(row = row, column = column, columnspan = 3)
        
        self.border = self.create_rectangle(5, 5, self.length - 5, self.width - 5)
        
    def start(self, override=False):
        # start and initialize basics
        if self.started and not override:
            return
        self.init()
        if not self.started: # still same mainloop to stop speeding up
            self.mainloop()
        self.started = True
    
    def restart(self):
        # start no matter what
        self.start(override= True)
    
    def mainloop(self):
        # keep track of time (ticks)
        self.tick += 1
        self.tick %= 100000
        # every 50 ticks (or milliseconds)
        if self.tick % 50 == 0:
            # update and do garbage collection on objects (optimizes performance)
            for obj in self.objs:
                obj.update()
                if (obj.stopped):
                    self.stopped.append(obj)
            for obj in self.objs:
                if obj in self.stopped:
                    # delete unused objects
                    del obj
                
        self.stopped = []
        # keep running mainloop
        self.after(1, self.mainloop)
    
    def init(self):
        # begin transition to create level select
        if not self.gwind.started:
            self.t = Transition(self, func = "create")
        
    def startshop(self):
        # begin transition to create shop
        if not self.gwind.started:
            self.t = Transition(self, func = "shop")
    
    def create(self):
        # create level select
        global buttons
        buttons = []
        self.create_rectangle(5, 5, self.length - 5, self.width - 5, fill = "gray")
        self.create_text(230, 25, text = "Level Select", font = Font(size=25))
        levels = ["Circle Land", "Square Adventure", "Triangle Battle"]
        x = 50
        for level in levels:
            # add buttons
            b = CButton(x, 70, 100, 100, self, level, select=True)
            buttons.append(b)
            x += 125
            
    def shop(self):
        # create shop
        global buttons
        buttons = []
        self.create_rectangle(5, 5, self.length - 5, self.width - 5, fill = "beige")
        self.create_rectangle(5, 375, self.length - 5, self.width - 5, fill = "black")
        self.create_text(230, 25, text = "Shop", font = Font(size = 25))
        # add button
        b = CButton(130, 150, 70, 70, self, "Tank")
        c = CButton(130, 250, 70, 70, self, "Heal")
        buttons.append(b)
    
    def store(self, e):
        # store x and y coords of cursor
        self.x = e.x
        self.y = e.y
        
    def onclick(self, _):
        # check if buttons have been clicked
        global buttons
        for b in buttons:
            if b.c_point(self.x, self.y):
                b.onclick()
    
# handles the game window and its canvas
class gHandler(cHandler):
    def __init__(self, window, length, width):
        self.level = ""
        self.created = False
        # run the initialization for the parent class, cHandler
        super().__init__(window, length, width)
        # initialize variables
        self.hp = 500
        self.other = 500
        self.money = 0
        self.omoney = 0
        self.rate = 1
        self.started = False
        self.bhp = None
        self.ehp = None
        self.md = None
        self.omd = None
        self.ended = False
        self.tut = True
        self.purchased = ["Square"]
        self.won = []
        dat = {"purchased":self.purchased, "won":self.won, "tut":True}
        # open user's data to store
        if not os.path.isfile('save.squarefile'):
            with open("save.squarefile", "wb") as save:
                pickle.dump(dat, save)
        else:
            with open("save.squarefile", "rb") as save:
                dat = pickle.load(save)
                self.won = dat["won"]
                self.purchased = dat["purchased"]
        # check for clicks
        self.bind_all("<Button-1>", self.onclick)
        
    def start(self, level, override = False):
        # start, with an option to decide a level
        if self.started and not override:
            return
        if (override):
            self.created = False
        self.init(level)
        if not self.started: # still same mainloop to stop speeding up
            self.mainloop()
        self.started = True
        
    def init(self, level):
        # begin a transition to create a level
        self.level = level
        self.t = Transition(self, func = "create")
        
    def create(self):
        if self.created:
            return
        self.created = True
        # set up enemy side
        if (self.level == "Circle Land"):
            self.circleland()
            self.other = 314
        if (self.level == "Square Adventure"):
            self.squareadventure()
            self.other = 500
        if (self.level == "Triangle Battle"):
            self.trianglebattle()
            self.other = 650
        # set up own side and UI
        self.setup()
    def setup(self):
        # give tutorial if it is your first time
        if self.tut:
            messagebox.showinfo("Tutorial Start", "Hello! To play this level, you must summon squares to defeat your enemy's base (on the left).")
            messagebox.showinfo("Buying Squares", "The basic square has a cost of 100, so wait till your money (on the right) reaches 100. Then, click the top left button labeled 'Square.'")
            messagebox.showinfo("Economy", "You can also increase your production of money by clicking the button (top right) labeled 'Economy.' You can upgrade this a maximum of three times, with costs of 150, 300, and 500, respectively.")
            messagebox.showinfo("Goodbye", "That's all. Good luck on beating this game's levels!")
            self.tut = False
        with open("save.squarefile", "wb") as save:
            pickle.dump({"purchased":self.purchased, "won":self.won}, save)
        self.ended = False
        self.hp = 500
        self.money = 0
        self.omoney = 0
        self.rate = 1
        # set up UI elements
        self.us = self.create_rectangle(475, 475, 575, 375, fill = "white")
        self.md = self.create_text(425, 150, text = "$" + str(self.money), font = Font(size=15), fill="yellow")
        self.omd = self.create_text(75, 200, text = "Enemy Money: $" + str(self.omoney), font = Font(size=15), fill="red")
        self.bhp = self.create_text(425, 250, text = "HP: " + str(self.hp), font = Font(size=15))
        self.ehp = self.create_text(50, 250, text = "HP: " + str(self.other), font = Font(size=15))
        
        self.lab = self.create_text(100, 30, text = self.level, font = Font(size = 20))
        # set up buttons to buy units
        global buttons
        for i in self.purchased:
            if i == "Square":
                buttons.append(CButton(30, 70, 70, 70, self, "Square"))
            if i == "Tank":
                buttons.append(CButton(130, 70, 70, 70, self, "Tank"))
            if i == "Heal":
                buttons.append(CButton(230, 70, 70, 70, self, "Heal"))
        buttons.append(CButton(420, 70, 70, 70, self, "Economy"))
        
    # different settings for different levels
    def circleland(self):
        self.create_rectangle(5, 5, 500, 500, fill="gray")
        self.create_rectangle(5, 470, 500, 500, fill = "green")
        self.enemy = self.create_oval(-60, 475, 35, 375, fill = "blue")
        
    def squareadventure(self):
        self.create_rectangle(5, 5, 500, 500, fill="gray")
        self.create_rectangle(5, 470, 500, 500, fill = "purple")
        self.enemy = self.create_rectangle(-60, 475, 25, 325, fill = "green")
        
    def trianglebattle(self):
        self.create_rectangle(5, 5, 500, 500, fill="gray")
        self.create_rectangle(5, 470, 500, 500, fill = "red")
        self.enemy = self.create_polygon(-30, 475, 55, 475, 12.5, 375, fill = "purple")
    
    # check if buttons are clicked
    def onclick(self, _):
        global buttons
        for b in buttons:
            if b.c_point(self.x, self.y):
                b.onclick()
        
    # mainloop
    def mainloop(self):
        # keep track of time
        self.tick += 1
        self.tick %= 100000
        if self.tick % 50 == 0:
            # garbage collection and object updates
            for obj in self.objs:
                obj.update()
                if (obj.stopped):
                    self.stopped.append(obj)
            for obj in self.objs:
                if obj in self.stopped:
                    del obj
            # update UI elements
            if (self.bhp):
                self.itemconfig(self.bhp, text = "HP: " + str(self.hp))
            if (self.ehp):
                self.itemconfig(self.ehp, text = "HP: " + str(self.other))
            if (self.md):
                self.itemconfig(self.md, text = "$" + str(round(self.money)) + "/$500")
                self.money = min(self.money + self.rate, 500)
            if (self.omd):
                self.itemconfig(self.omd, text = "Enemy Money\n $" + str(self.omoney) + "/$500")
                self.omoney = min(self.omoney + 1, 500)
            # check if game is over yet
            if (not self.ended):
                if (self.hp <= 0):
                    self.t = Transition(self, func = "end")
                    self.ended = True
                if (self.other <= 0):
                    self.t = Transition(self, func = "win")
                    self.ended = True
        
        # spawn enemy units
        if self.tick % 1500 == 0 and not self.ended:
            if (self.level == "Circle Land"):
                if self.omoney >= 15 and random.randint(1, 7) == 1:
                    Oval(0, 445, self)
                    self.omoney -= 15
                if self.omoney >= 75:
                    Circle(0, 445, self)
                    self.omoney -= 75
            if (self.level == "Square Adventure"):
                if self.omoney >= 175:
                    Rectangle(0, 445, self)
                    self.omoney -= 75
            if (self.level == "Triangle Battle"):
                if self.omoney >= 200:
                    Triangle(0, 445, self)
                    self.omoney -= 200
            
        self.stopped = []
        self.after(1, self.mainloop)
        
    def showdamage(self, issquare):
        # show damage to bases by causing them to flash red
        if (issquare):
            self.itemconfig(self.enemy, fill = "red")
            self.after(150, self.hideen)
        else:
            self.itemconfig(self.us, fill = "red")
            self.after(150, self.hideme)
            
    # bases will not stay red, reverting back to their colors using these functions
    def hideen(self):
        if (self.level == "Circle Land"):
            self.itemconfig(self.enemy, fill = "blue")
        if (self.level == "Square Adventure"):
            self.itemconfig(self.enemy, fill = "green")
        if (self.level == "Triangle Battle"):
            self.itemconfig(self.enemy, fill = "purple")
            
    def hideme(self):
        self.itemconfig(self.us, fill = "white")
    
                
    def win(self):
        self.create_rectangle(5, 5, 500, 500, fill="white")
        self.create_text(250, 250, text = "YOU WIN", fill = "green", font = Font(size=25))
        self.started = False
        self.dele()
        # store user data
        with open("save.squarefile", "wb") as save:
            pickle.dump({"purchased":self.purchased, "won":self.won}, save)
        if self.level not in self.won:
            self.won.append(self.level)
            if len(self.won) == 1:
                messagebox.showinfo("Congratulations", "You have beaten your first level! Click on a level in the select screen to try another!")
            elif len(self.won) == 2:
                messagebox.showinfo("Congratulations", "Wow, two levels! Only one more to go!")
            elif len(self.won) == 3:
                messagebox.showinfo("Congratulations", "You have beaten all the levels in this game. Thank you for playing this game; I hope you enjoyed it!")
             
    def end(self):
        self.create_rectangle(5, 5, 500, 500, fill="white")
        self.create_text(250, 250, text = "GAME OVER", fill = "red", font = Font(size=25))
        self.started = False
        self.dele()
        
    # delete all units
    def dele(self):
        for i in range(len(self.objs)):
            try:
                if (self.objs[i].isunit):
                    self.objs[i].stopped = True
                    self.objs[i].isunit = False
                else:
                    pass
            except:
                pass

# transitions between scenes
class Transition(Obj):
    def __init__(self, canv, func=None):
        super().__init__(500, 0, 500, 500, canv)
        self.speed = 0
        self.end = False
        self.func = func
    def update(self):
        if (self.stopped):
            return
        if (self.x <= 0 and not self.end):
            self.move(-1 * self.x, 0)
            self.fin()
            return
        self.speed -= 5
        self.move(self.speed, 0)
        if (self.x <= -500):
            self.stopped = True
            return
    # when finished, a scene is triggered
    def fin(self):
        if (self.stopped):
            return
        if (self.end):
            return
        if (self.func == "create"):
            self.canv.create()
        elif (self.func == "shop"):
            self.canv.shop()
        elif (self.func == "end"):
            self.canv.end()
        elif (self.func == "win"):
            self.canv.win()
        self.draw()
        self.end = True

# self explanatory, a simple button to trigger events
class CButton(Obj):
    def __init__(self, x, y, length, width, canv, text, select=False):
        self.text = text
        super().__init__(x, y, length, width, canv)
        global buttons
        buttons.append(self)
        self.select = select
        self.cooldown = True
        
    def onclick(self):
        if (self.select and self.canv.gwind.started):
            return
        if (not self.cooldown):
            return
        self.flash()
        if (self.select):
            self.canv.gwind.start(self.text, override=True)
        # create units or economy
        if (str(type(self.canv)) == "<class '__main__.gHandler'>"):
            if (self.text == "Square" and self.canv.money >= 100):
                Square(475, 445, self.canv)
                self.canv.money -= 100
            elif (self.text == "Tank" and self.canv.money >= 150):
                Tank(475, 445, self.canv)
                self.canv.money -= 150
            elif (self.text == "Heal" and self.canv.money >= 150):
                Heal(475, 445, self.canv)
                self.canv.money -= 150
            elif (self.text == "Economy"):
                if (self.canv.rate == 1 and self.canv.money >= 150):
                    self.canv.rate += 0.2
                    self.canv.money -= 150
                if (self.canv.rate == 1.2 and self.canv.money >= 300):
                    self.canv.rate += 0.5
                    self.canv.money -= 300
                if (self.canv.rate == 1.7 and self.canv.money >= 500):
                    self.canv.rate += 0.3
                    self.canv.money -= 500
            else:
                print("Not enough money!")
        else: # buy units
            global gwc
            if (self.text == "Tank"):
                if (len(self.canv.gwind.won) > 0):
                    gwc.purchased.append("Tank")
                    # store user data
                    with open("save.squarefile", "wb") as save:
                        pickle.dump({"purchased":gwc.purchased, "won":gwc.won, "tut":gwc.tut}, save)
                else:
                    messagebox.showinfo("Insufficient Funds", "You must win one game before you can get this square!")
            if (self.text == "Heal"):
                if (len(self.canv.gwind.won) > 1):
                    gwc.purchased.append("Heal")
                    # store user data
                    with open("save.squarefile", "wb") as save:
                        pickle.dump({"purchased":gwc.purchased, "won":gwc.won, "tut":gwc.tut}, save)
                else:
                    messagebox.showinfo("Insufficient Funds", "You must win two games before you can get this square!")
        
    def draw(self):
        self.bord = self.canv.create_rectangle(self.x, self.y, self.x + self.length, self.y + self.width, fill = "white")
        self.txt = self.canv.create_text(self.x + self.length / 2, self.y + self.width / 2, text=self.text)
        self.parts.append(self.bord)
        self.parts.append(self.txt)
        
    def flash(self):
        self.canv.itemconfig(self.bord, fill="black")
        self.canv.itemconfig(self.text, fill="white")
        self.canv.after(75, self.reset)
        self.cooldown = False
        
    def reset(self):
        self.canv.itemconfig(self.bord, fill="white")
        self.canv.itemconfig(self.text, fill="black")
        self.cooldown = True

# create windows and basics
gwind = mmenu = gwc = None

mmenu = tk.Tk()
mmenu.geometry("+720+250")
mmenu.title("Main Menu")
# top level window is subordinate to main window
gwind = tk.Toplevel(mmenu)
gwind.title("Game Window")
gwind.geometry("-550+250")
gwc = gHandler(gwind, 500, 500)
# add elements to main window
ch = cHandler(mmenu, 450, 450, gwind=gwc)
ch.add(row = 2, column = 0)
lab = tk.Label(mmenu, text = "Battle Squares", font = ("Helvetica", 30, "bold"))
b = tk.Button(mmenu, text = "Start", command = ch.init, width = 15, height = 5)
lab.grid(row = 0, column = 1, padx = 5, pady = 5)
b.grid(row = 1, column = 1, padx = 5, pady = 5)
b2 = tk.Button(mmenu, text = "Exit", command = mmenu.destroy, width = 15, height = 5)
b2.grid(row = 1, column = 0, padx = 5, pady = 5)
b3 = tk.Button(mmenu, text = "Shop", command = ch.startshop, width = 15, height = 5)
b3.grid(row = 1, column = 2, padx = 5, pady = 5)


gwc.add()

if gwc.tut:
    messagebox.showinfo("Start", "Welcome to Battle Squares! This is the main menu where you can choose between playing levels and buying units.")
    messagebox.showinfo("Playing levels", "If you haven't beaten a level yet, I recommend that you press the button labeled 'Start.' After the transition finishes, click the name of a level on the bottom to play it.")
    messagebox.showinfo("Shop", "Once you've beaten a level, you can press the button labeled 'Shop' to get more options of units the next time you play.")
    messagebox.showinfo("Bye for now", "Alright! Play a level, and more instructions will follow there. ")

mmenu.mainloop()